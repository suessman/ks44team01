<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="~{layout/default}">
<head>
    <meta charset="UTF-8">
    <th:block layout:fragment="customTitle">
    <title>readBoard</title>
    </th:block>
</head>
    <th:block layout:fragment="customContents">
   	<div class="menu-title">
		<h3>게시글 열람</h3> 
	</div>
<body>
	<div>
		<div class="title-group" id="top">
			<h5>[말머리]게시글 제목</h5>
		</div>
		<div style="text-align: center;">
			<a href="#">작성자</a>
			<span>작성 시간</span>
			<span>조회수</span>
		</div>
	</div>
	
	<div style="text-align: center;">
		<textarea rows="30" cols="70" disabled="disabled">작성자가 작성한 내용</textarea>
	</div>

	<div style="text-align: center;">
		<div>
			<input placeholder="댓글을 남겨주세요." maxlength="100" style="width:400px; margin:10px;">
			<button type="submit">댓글 등록</button>
		</div>
	</div>
	
	<div style="text-align: center;">
		<a href="/board/modifyBoard"><button>수정하기</button></a>
		<a href="javascript:add_check('/board/boardList')"><button>삭제하기</button></a>
		<a href="/board/boardList"><button>목록 이동</button></a>
		<a href="#top"><button>위로 가기</button></a>
	</div>
	
	<div class="card m-2" id="comments-new">
    <div class="card-body">
        <!-- 댓글 작성 폼 -->
        <form>
            <!-- 닉네임 입력-->
            <div class="bm-3">
                <label class="form-label">닉네임</label>
                <input class="form-control form-control-sm" id="new-comment-nickname">
            </div>
            <!-- 댓글 본문 입력 -->
            <div class="mb-3">
                <label class="form-label">댓글 내용</label>
                <textarea class="form-control form-control-sm" rows="3" id="new-comment-body"></textarea>
            </div>

            <!-- 히든 인풋 -->
            {{#article}}
                <input type="hidden" id="new-comment-article-id" value="{{id}}">
            {{/article}}

            <!-- 전송 버튼 -->
            <button type="button" class="btn btn-outline-primary btn-sm" id="comment-create-btn">댓글 작성</button>
        </form>
    </div>
</div>

<script>
    {
        // 댓글 생성 버튼을 변수화 (id가 comment-create-btn인 대상을 선택해서 가져옴)
        const commentCreateBtn = document.querySelector("#comment-create-btn");

        // 버튼 클릭 이벤트를 감지!!
        commentCreateBtn.addEventListener("click", function() {
            // 새 댓글 객체 생성
            const comment = {
                nickname: document.querySelector("#new-comment-nickname").value,
                body: document.querySelector("#new-comment-body").value,
                article_id: document.querySelector("#new-comment-article-id").value,
            };

            // 댓글 객체 출력
            console.log(comment);

            // fetch() - Talend API 요청을 JavaScript로 보내준다!
            const url = "/api/articles/" + comment.article_id + "/comments";
            fetch(url, {
                method: "post",     // POST 요청을 보낸다.
                body: JSON.stringify(comment),     // comment JS 객체를 JSON으로 변경하여 보냄
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
            // http 응답 코드에 따른 메세지 출력
            const msg = (response.ok) ? "댓글이 등록 되었습니다." : "댓글 등록 실패..!";
            alert(msg);
            // 현재 페이지 새로고침
            window.location.reload();
            });
        });
    }
</script>
	
	<script>	
		/*글 삭제 확인 시작*/
		function add_check(url){
			var answer;
			//페이지를 이동하기 전에 confirm()을 사용해 다시 한번 확인한다.
			//확인을 선택하면 answer에  true, 취소를 선택하면 false 값이 들어간다.
			answer = confirm("글을 삭제하시겠습니까?");
			//확인을 선택한 경우 자바스크립트를 호출할 때 같이 넘어온 url이라는 변수에 들어있는 주소로 페이지 이동
			if(answer == true){
				location = url;
			}
		}
		/*글 삭제 확인 끝*/
	</script>
	
</body>
</th:block>
</html>